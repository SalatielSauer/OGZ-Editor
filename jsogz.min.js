/* JS object to .OGZ translator by @SalatielSauer. */

function floatHex(t){var e=new DataView(new ArrayBuffer(4));return e.setFloat32(0,t),Array.apply(null,{length:4}).map((t,a)=>(t=>("00"+t.toString(16)).slice(-2))(e.getUint8(a))).reverse().join("")}function intHex(t,e){return(t=parseInt(t)).toString(16).padStart(e,"0").match(/.{2}/g).reverse().join("")}function strHex(t){return t.split("").reduce((t,e)=>t+=e.charCodeAt(0).toString(16).padStart(2,"0"),"")}function hextoByte(t){return new Uint8Array(t.match(/.{2}/g).map(t=>parseInt(t,16)))}function formathead(t,e,a,r,n,o){rawheaddata="4f4354411d00000024000000";try{for(i=0;i<arguments.length;i++)rawheaddata+=intHex(arguments[i],8)}finally{return rawheaddata}}function formatvar(t,e,a){return intHex(t,2)+intHex(e.length,4)+strHex(e)+intHex(a.length,4)+strHex(a)}function formatent(t,e,a){return a=entitiesarray.filter(t=>{if(a.match(t))return t})[0],t=t.split(" "),e=e.split(" "),-1==entitiesarray.indexOf(a)&&(a="empty"),floatHex(t[0])+floatHex(t[1])+floatHex(t[2])+intHex(e[0],4)+intHex(e[1],4)+intHex(e[2],4)+intHex(e[3],4)+intHex(e[4],4)+intHex(entitiesarray.indexOf(a),2)+"00"}function formatoctree(e,a,r){a=a.split(" "),textureraw="";try{for(t=0;t<a.length;t++)textureraw+=intHex(a[t],2)+"00"}finally{return intHex(e,2)+textureraw+intHex(r,2)}}function getobjkeys(t){return t?Object.keys(t):[]}function getOGZ(t,e,a){if("string"==typeof t){for(var r=0;r<entitiesarray.length;r++)enttype=new RegExp(entitiesarray[r],"g"),t=t.replace(enttype,t=>t+r++);try{t=JSON.parse(t)}catch(r){return void(a&&a(r))}}for(var n of(mapdata="",mapdata+=formathead(t.mapsize||1024,getobjkeys(t.entities).length,0,0,0,getobjkeys(t.mapvars).length),getobjkeys(t.mapvars)))mapdata+=formatvar(2,n,t.mapvars[n]);for(var n of(mapdata+="0366707300",mapdata+="00000000050002000400030005000700",getobjkeys(t.entities)))mapdata+=formatent(t.entities[n].position,t.entities[n].attributes,n);switch(mapdata+=formatoctree(2,"2 3 4 5 6 7",0)+formatoctree(2,"2 3 4 5 6 7",0)+formatoctree(2,"2 3 4 5 6 7",0)+formatoctree(2,"2 3 4 5 6 7",0),mapdata+=formatoctree(1,"0 0 0 0 0 0",0)+formatoctree(1,"0 0 0 0 0 0",0)+formatoctree(1,"0 0 0 0 0 0",0)+formatoctree(1,"0 0 0 0 0 0",0),e){case 0:default:return mapdata;case 1:return hextoByte(mapdata);case 2:if(pako)return pako.gzip(hextoByte(mapdata));console.log("%c pako not found, you need it to get the data in .ogz format: https://github.com/nodeca/pako","color: red")}}entitiesarray=["empty","light","mapmodel","playerstart","envmap","particles","sound","spotlight","gamespecific"];